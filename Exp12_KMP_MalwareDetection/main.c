#include <stdio.h>
#include <string.h>
#include "kmp.h"

/*
    Scenario:
    Cyber Security â€“ Detecting Malware Signature in Log Files

    Text = multi-line security log.
    Pattern = malware signature (e.g., "X5O!P%@AP[4\\PZX").
*/

void loadDemoLogText(char text[])
{
    strcpy(text,
           "2025-12-06 10:01:23 INFO  System boot complete\n"
           "2025-12-06 10:02:10 INFO  User login from 192.168.1.10\n"
           "2025-12-06 10:05:47 WARN  Suspicious activity detected\n"
           "2025-12-06 10:06:12 INFO  Scanning file payload.exe\n"
           "2025-12-06 10:06:13 ALERT Malware signature X5O!P%@AP[4\\PZX found in payload.exe\n"
           "2025-12-06 10:06:15 INFO  File quarantined successfully\n");

    printf("\nLoaded Demo Security Log Text:\n%s\n", text);
}

int main()
{
    char text[MAX_TEXT], pattern[MAX_PATTERN];
    int choice;

    while (1)
    {
        printf("\n===== Experiment 12 - KMP Algorithm (Cyber Security Logs) =====\n");
        printf("1. Use Demo Security Log Text\n");
        printf("2. Enter Custom Log Text\n");
        printf("3. Exit\n");
        printf("Enter choice: ");
        scanf("%d", &choice);
        getchar();  // clear leftover newline

        if (choice == 1)
        {
            loadDemoLogText(text);
        }
        else if (choice == 2)
        {
            printf("\nEnter the log text (max %d characters):\n", MAX_TEXT - 1);
            fgets(text, sizeof(text), stdin);
            text[strcspn(text, "\n")] = '\0';
        }
        else if (choice == 3)
        {
            printf("Exiting...\n");
            return 0;
        }
        else
        {
            printf("Invalid option. Try again.\n");
            continue;
        }

        printf("\nEnter the malware signature / pattern to search (max %d chars):\n",
               MAX_PATTERN - 1);
        fgets(pattern, sizeof(pattern), stdin);
        pattern[strcspn(pattern, "\n")] = '\0';

        KMPSearch(text, pattern);
    }

    return 0;
}
